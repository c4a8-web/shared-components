{%- assign blogRecentSlider = include.slider -%}
{%- assign blogRecentTag = include.tag -%}
{%- assign blogRecentHeadline = include.headline -%}
{%- assign blogRecentHeadlineLevel = include.level -%}
{%- assign blogRecentLimit = include.limit | default: 3 -%}
{%- assign blogRecentLimitEvents = include.limitEvents | default: blogRecentLimit -%}
{%- assign blogRecentBgColor = include.bgColor | default: 'var(--color-blue-light)' -%}
{%- assign blogRecentEvents = include.events -%}
{%- assign blogRecentCombine = include.combine -%}
{%- assign blogRecentCta = include.cta -%}

{%- if blogRecentCombine -%}
  {%- assign blogRecentEvents = true -%}
{%- endif -%}

{%- if blogRecentSlider -%}
  {%- assign skin = 'has-slider' -%}
  {%- assign containerClasses = 'js-slick-carousel' -%}
  {%- assign itemClasses = 'mb-6 mb-lg-0 blog-recent__slide' -%}
  {%- assign hideContainer = false -%}
{%- else -%}
  {%- assign skin = '' -%}
  {%- assign containerClasses = 'row mb-3' -%}
  {%- assign itemClasses = 'col-sm-6 col-lg-4 mb-3 mb-sm-8' -%}
  {%- assign hideContainer = include.hideContainer | default: false -%}
{%- endif -%}

{%- if blogRecentEvents -%}
  {% assign events = site.events | where_exp:"item","item.lang == page.lang" | sort: 'date' | reverse %}
  {% assign events = events | where_exp:"item","item.webcast == true" %}
  {% assign events = events | where_exp:"item","item.hideInRecent != true" | slice: 0, blogRecentLimitEvents %}
{%- endif -%}

{%- if blogRecentCombine -%}
  {% assign posts = site.posts | where_exp:"item","item.lang == page.lang" %}
  {% assign posts = posts | concat: events %}
  {% assign posts = posts | sort: 'date' | reverse %}
{%- else -%}
  {% if blogRecentEvents %}
    {% assign posts = events %}
  {% else %}
    {% assign posts = site.posts | where_exp:"item","item.lang == page.lang" %}
  {% endif %}
{%- endif -%}

{% if blogRecentTag %}
  {% assign tagExpression = '' %}

  {% for tag in blogRecentTag %}
    {% capture tagExpression %}{{ tagExpression }}item.tags contains '{{ tag }}'{% unless forloop.last %} or {% endunless %}{% endcapture %}
  {% endfor %}

  {% assign posts = posts | where_exp: "item", tagExpression %}
{% endif %}

{% if posts.size -%}
  <!-- Shared Blog Recent Section -->
  <div class="blog-recent {{ skin }} {% unless hideContainer %}mt-10{% endunless %}">
    {% if skin != '' %}
    <div class="blog-recent__bg" style="background-color:{{ blogRecentBgColor }}"></div>
    {% endif %}
  {% unless hideContainer %}
  <div class="container">
  {% endunless %}
      {% if blogRecentHeadline %}
        <div class="row">
          <div class="col-lg-12 col-md-10 mt-6 mt-lg-8 mb-4 mb-lg-6">
            {% assign level = blogRecentHeadlineLevel | default: "h3" %}
            {%
              include headline.html
              level=level
              text=blogRecentHeadline
              classes="h2-font-size"
            %}
          </div>
        </div>
      {% endif %}
      <div class="blog-recent__container {{ containerClasses }}"
        data-hs-slick-carousel-options='{
          "slidesToShow": 3,
          "slidesToScroll": 3,
          "prevArrow": "<span class=\"slick__arrow-left rounded-circle\"></span>",
          "nextArrow": "<span class=\"slick__arrow-right rounded-circle\"></span>",
          "dots": true,
          "centerMode": false,
          "dotsClass": "slick-pagination is-default",
          "responsive": [{
            "breakpoint": 1200,
              "settings": {
                "slidesToShow": 3,
                "slidesToScroll": 3
              }
            }, {
            "breakpoint": 992,
            "settings": {
              "centerMode": true,
              "infinite": true,
              "centerPadding": "30px",
              "slidesToShow": 2,
              "slidesToScroll": 2
              }
            }, {
            "breakpoint": 768,
            "settings": {
              "centerMode": true,
              "infinite": false,
              "centerPadding": "30px",
              "slidesToShow": 1,
              "slidesToScroll": 1
              }
            }, {
              "breakpoint": 576,
              "settings": {
                "centerMode": true,
                "infinite": false,
                "centerPadding": "20px",
                "slidesToShow": 1,
                "slidesToScroll": 1
            }
          }]
        }'
      >
        {% for post in posts %}
          {% if forloop.index <= blogRecentLimit %}
            <div class="{{ itemClasses }}">
              {% if post.blogtitlepic %}
                {% capture imgUrl %}{{ site.blog_image_path }}{{ post.blogtitlepic }}{% endcapture %}
              {% else %}
                {% assign imgUrl = false %}
              {% endif %}
              {% if post.layout == 'post' %}
                {% assign cardEvent = false %}
                {% assign cardTarget = false %}
                {% assign cardUrl = post.url %}
              {% else %}
                {% assign cardEvent = true %}
                {% assign cardUrl = post.cta.href %}
                {% assign cardTarget = '_blank' %}
              {% endif %}

              {%
                include card.html
                title=post.title
                blogtitlepic=imgUrl
                excerpt=post.excerpt
                date=post.date
                url=cardUrl
                author=post.author
                event=cardEvent
                target=cardTarget
              %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
      {% if blogRecentCta %}
        <div class="blog-recent__cta-row row col-lg-12">
          {%
            include cta.html
            text=blogRecentCta.text
            href=blogRecentCta.href
            skin=blogRecentCta.skin
            width=blogRecentCta.width
            external=blogRecentCta.external
          %}
        </div>
      {% endif %}
  {% unless hideContainer %}
    </div>
  {% endunless %}
  </div>
  <!-- End Shared Blog Recent Section -->
{% endif %}
