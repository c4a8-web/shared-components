/*! For license information please see 3736.dba8d3a7.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkshared_components=self.webpackChunkshared_components||[]).push([[3736],{"./node_modules/liquidjs/dist/liquid.browser.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{HX:()=>Liquid});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}var Drop=function(){function Drop(){}return Drop.prototype.valueOf=function(){},Drop.prototype.liquidMethodMissing=function(key){},Drop}(),toStr=Object.prototype.toString,toLowerCase=String.prototype.toLowerCase;function isString(value){return"string"==typeof value}function isFunction(value){return"function"==typeof value}function stringify(value){return isString(value=toValue$1(value))?value:isNil(value)?"":String(value)}function toValue$1(value){return value instanceof Drop?value.valueOf():value}function isNumber(value){return"number"==typeof value}function toLiquid(value){return value&&isFunction(value.toLiquid)?toLiquid(value.toLiquid()):value}function isNil(value){return null==value}function isArray(value){return"[object Array]"===toStr.call(value)}function forOwn(obj,iteratee){for(var k in obj=obj||{})if(Object.hasOwnProperty.call(obj,k)&&!1===iteratee(obj[k],k,obj))break;return obj}function last$1(arr){return arr[arr.length-1]}function isObject(value){var type=typeof value;return null!==value&&("object"===type||"function"===type)}function range(start,stop,step){void 0===step&&(step=1);for(var arr=[],i=start;i<stop;i+=step)arr.push(i);return arr}function padStart(str,length,ch){return void 0===ch&&(ch=" "),pad(str,length,ch,(function(str,ch){return ch+str}))}function pad(str,length,ch,add){for(var n=length-(str=String(str)).length;n-- >0;)str=add(str,ch);return str}function identify(val){return val}function snakeCase(str){return str.replace(/(\w?)([A-Z])/g,(function(_,a,b){return(a?a+"_":"")+b.toLowerCase()}))}function caseInsensitiveCompare(a,b){return null==a&&null==b?0:null==a?1:null==b||(a=toLowerCase.call(a))<(b=toLowerCase.call(b))?-1:a>b?1:0}var Node=function Node(key,value,next,prev){this.key=key,this.value=value,this.next=next,this.prev=prev},LRU=function(){function LRU(limit,size){void 0===size&&(size=0),this.limit=limit,this.size=size,this.cache={},this.head=new Node("HEAD",null,null,null),this.tail=new Node("TAIL",null,null,null),this.head.next=this.tail,this.tail.prev=this.head}return LRU.prototype.write=function(key,value){if(this.cache[key])this.cache[key].value=value;else{var node=new Node(key,value,this.head.next,this.head);this.head.next.prev=node,this.head.next=node,this.cache[key]=node,this.size++,this.ensureLimit()}},LRU.prototype.read=function(key){if(this.cache[key]){var value=this.cache[key].value;return this.remove(key),this.write(key,value),value}},LRU.prototype.remove=function(key){var node=this.cache[key];node.prev.next=node.next,node.next.prev=node.prev,delete this.cache[key],this.size--},LRU.prototype.clear=function(){this.head.next=this.tail,this.tail.prev=this.head,this.size=0,this.cache={}},LRU.prototype.ensureLimit=function(){this.size>this.limit&&this.remove(this.tail.prev.key)},LRU}();function domResolve(root,path){var base=document.createElement("base");base.href=root;var head=document.getElementsByTagName("head")[0];head.insertBefore(base,head.firstChild);var a=document.createElement("a");a.href=path;var resolved=a.href;return head.removeChild(base),resolved}var fs=Object.freeze({__proto__:null,resolve:function resolve(root,filepath,ext){return root.length&&"/"!==last$1(root)&&(root+="/"),domResolve(root,filepath).replace(/^(\w+:\/\/[^/]+)(\/[^?]+)/,(function(str,origin,path){var last=path.split("/").pop();return/\.\w+$/.test(last)?str:origin+path+ext}))},readFile:function readFile(url){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,new Promise((function(resolve,reject){var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.status>=200&&xhr.status<300?resolve(xhr.responseText):reject(new Error(xhr.statusText))},xhr.onerror=function(){reject(new Error("An error occurred whilst receiving the response."))},xhr.open("GET",url),xhr.send()}))]}))}))},readFileSync:function readFileSync(url){var xhr=new XMLHttpRequest;if(xhr.open("GET",url,!1),xhr.send(),xhr.status<200||xhr.status>=300)throw new Error(xhr.statusText);return xhr.responseText},exists:function exists(filepath){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,!0]}))}))},existsSync:function existsSync(filepath){return!0},dirname:function dirname(filepath){return domResolve(filepath,".")},sep:"/"});function isComparable(arg){return arg&&isFunction(arg.equals)}function isTruthy(val,ctx){return!isFalsy(val,ctx)}function isFalsy(val,ctx){return ctx.opts.jsTruthy?!val:!1===val||null==val}var defaultOperators={"==":function(l,r){return isComparable(l)?l.equals(r):isComparable(r)?r.equals(l):l===r},"!=":function(l,r){return isComparable(l)?!l.equals(r):isComparable(r)?!r.equals(l):l!==r},">":function(l,r){return isComparable(l)?l.gt(r):isComparable(r)?r.lt(l):l>r},"<":function(l,r){return isComparable(l)?l.lt(r):isComparable(r)?r.gt(l):l<r},">=":function(l,r){return isComparable(l)?l.geq(r):isComparable(r)?r.leq(l):l>=r},"<=":function(l,r){return isComparable(l)?l.leq(r):isComparable(r)?r.geq(l):l<=r},contains:function(l,r){return!(!l||!isFunction(l.indexOf))&&l.indexOf(r)>-1},and:function(l,r,ctx){return isTruthy(l,ctx)&&isTruthy(r,ctx)},or:function(l,r,ctx){return isTruthy(l,ctx)||isTruthy(r,ctx)}},TYPES=[0,0,0,0,0,0,0,0,0,20,4,4,4,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,2,8,0,0,0,0,8,0,0,0,64,0,65,0,0,33,33,33,33,33,33,33,33,33,33,0,0,2,2,2,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],IDENTIFIER=1,BLANK=4,INLINE_BLANK=16;function createTrie(operators){var e_1,_a,trie={};try{for(var _b=__values(Object.entries(operators)),_c=_b.next();!_c.done;_c=_b.next()){for(var _d=__read(_c.value,2),name_1=_d[0],handler=_d[1],node=trie,i=0;i<name_1.length;i++){var c=name_1[i];node[c]=node[c]||{},i===name_1.length-1&&TYPES[name_1.charCodeAt(i)]&IDENTIFIER&&(node[c].needBoundary=!0),node=node[c]}node.handler=handler,node.end=!0}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return trie}TYPES[160]=TYPES[5760]=TYPES[6158]=TYPES[8192]=TYPES[8193]=TYPES[8194]=TYPES[8195]=TYPES[8196]=TYPES[8197]=TYPES[8198]=TYPES[8199]=TYPES[8200]=TYPES[8201]=TYPES[8202]=TYPES[8232]=TYPES[8233]=TYPES[8239]=TYPES[8287]=TYPES[12288]=BLANK;var defaultOptions={root:["."],layouts:["."],partials:["."],relativeReference:!0,cache:void 0,extname:"",fs,dynamicPartials:!0,jsTruthy:!1,trimTagRight:!1,trimTagLeft:!1,trimOutputRight:!1,trimOutputLeft:!1,greedy:!0,tagDelimiterLeft:"{%",tagDelimiterRight:"%}",outputDelimiterLeft:"{{",outputDelimiterRight:"}}",preserveTimezones:!1,strictFilters:!1,strictVariables:!1,lenientIf:!1,globals:{},keepOutputType:!1,operators:defaultOperators,operatorsTrie:createTrie(defaultOperators)};function normalizeDirectoryList(value){var list=[];return isArray(value)&&(list=value),isString(value)&&(list=[value]),list}var LiquidError=function(_super){function LiquidError(err,token){var _this=_super.call(this,err.message)||this;return _this.originalError=err,_this.token=token,_this.context="",_this}return __extends(LiquidError,_super),LiquidError.prototype.update=function(){var err=this.originalError;this.context=function mkContext(token){var line=__read(token.getPosition(),1)[0],lines=token.input.split("\n"),begin=Math.max(line-2,1),end=Math.min(line+3,lines.length);return range(begin,end+1).map((function(lineNumber){var indicator=lineNumber===line?">> ":"   ",num=padStart(String(lineNumber),String(end).length),text=lines[lineNumber-1];return"".concat(indicator).concat(num,"| ").concat(text)})).join("\n")}(this.token),this.message=function mkMessage(msg,token){token.file&&(msg+=", file:".concat(token.file));var _a=__read(token.getPosition(),2),line=_a[0],col=_a[1];return msg+=", line:".concat(line,", col:").concat(col)}(err.message,this.token),this.stack=this.message+"\n"+this.context+"\n"+this.stack+"\nFrom "+err.stack},LiquidError}(Error),TokenizationError=function(_super){function TokenizationError(message,token){var _this=_super.call(this,new Error(message),token)||this;return _this.name="TokenizationError",_super.prototype.update.call(_this),_this}return __extends(TokenizationError,_super),TokenizationError}(LiquidError),ParseError=function(_super){function ParseError(err,token){var _this=_super.call(this,err,token)||this;return _this.name="ParseError",_this.message=err.message,_super.prototype.update.call(_this),_this}return __extends(ParseError,_super),ParseError}(LiquidError),RenderError=function(_super){function RenderError(err,tpl){var _this=_super.call(this,err,tpl.token)||this;return _this.name="RenderError",_this.message=err.message,_super.prototype.update.call(_this),_this}return __extends(RenderError,_super),RenderError.is=function(obj){return"RenderError"===obj.name},RenderError}(LiquidError),UndefinedVariableError=function(_super){function UndefinedVariableError(err,token){var _this=_super.call(this,err,token)||this;return _this.name="UndefinedVariableError",_this.message=err.message,_super.prototype.update.call(_this),_this}return __extends(UndefinedVariableError,_super),UndefinedVariableError}(LiquidError),InternalUndefinedVariableError=function(_super){function InternalUndefinedVariableError(variableName){var _this=_super.call(this,"undefined variable: ".concat(variableName))||this;return _this.name="InternalUndefinedVariableError",_this.variableName=variableName,_this}return __extends(InternalUndefinedVariableError,_super),InternalUndefinedVariableError}(Error),AssertionError=function(_super){function AssertionError(message){var _this=_super.call(this,message)||this;return _this.name="AssertionError",_this.message=message+"",_this}return __extends(AssertionError,_super),AssertionError}(Error);var LookupType,Context=function(){function Context(env,opts,renderOptions){var _a,_b;void 0===env&&(env={}),void 0===opts&&(opts=defaultOptions),void 0===renderOptions&&(renderOptions={}),this.scopes=[{}],this.registers={},this.sync=!!renderOptions.sync,this.opts=opts,this.globals=null!==(_a=renderOptions.globals)&&void 0!==_a?_a:opts.globals,this.environments=env,this.strictVariables=null!==(_b=renderOptions.strictVariables)&&void 0!==_b?_b:this.opts.strictVariables}return Context.prototype.getRegister=function(key){return this.registers[key]=this.registers[key]||{}},Context.prototype.setRegister=function(key,value){return this.registers[key]=value},Context.prototype.saveRegister=function(){for(var _this=this,keys=[],_i=0;_i<arguments.length;_i++)keys[_i]=arguments[_i];return keys.map((function(key){return[key,_this.getRegister(key)]}))},Context.prototype.restoreRegister=function(keyValues){var _this=this;return keyValues.forEach((function(_a){var _b=__read(_a,2),key=_b[0],value=_b[1];return _this.setRegister(key,value)}))},Context.prototype.getAll=function(){return __spreadArray([this.globals,this.environments],__read(this.scopes),!1).reduce((function(ctx,val){return __assign(ctx,val)}),{})},Context.prototype.get=function(paths){var scope=this.findScope(paths[0]);return this.getFromScope(scope,paths)},Context.prototype.getFromScope=function(scope,paths){var _this=this;return"string"==typeof paths&&(paths=paths.split(".")),paths.reduce((function(scope,path){if(scope=function readProperty(obj,key){if(isNil(obj))return obj;if(isFunction((obj=toLiquid(obj))[key]))return obj[key]();if(obj instanceof Drop)return obj.hasOwnProperty(key)?obj[key]:obj.liquidMethodMissing(key);return"size"===key?function readSize(obj){if(obj.hasOwnProperty("size")||void 0!==obj.size)return obj.size;if(isArray(obj)||isString(obj))return obj.length;if("object"==typeof obj)return Object.keys(obj).length}(obj):"first"===key?function readFirst(obj){return isArray(obj)?obj[0]:obj.first}(obj):"last"===key?function readLast(obj){return isArray(obj)?obj[obj.length-1]:obj.last}(obj):obj[key]}(scope,path),isNil(scope)&&_this.strictVariables)throw new InternalUndefinedVariableError(path);return scope}),scope)},Context.prototype.push=function(ctx){return this.scopes.push(ctx)},Context.prototype.pop=function(){return this.scopes.pop()},Context.prototype.bottom=function(){return this.scopes[0]},Context.prototype.findScope=function(key){for(var i=this.scopes.length-1;i>=0;i--){var candidate=this.scopes[i];if(key in candidate)return candidate}return key in this.environments?this.environments:this.globals},Context}();function assert(predicate,message){if(!predicate){var msg="function"==typeof message?message():message||"expect ".concat(predicate," to be true");throw new AssertionError(msg)}}!function(LookupType){LookupType.Partials="partials",LookupType.Layouts="layouts",LookupType.Root="root"}(LookupType||(LookupType={}));var Loader=function(){function Loader(options){if(this.options=options,options.relativeReference){var sep=options.fs.sep;assert(sep,"`fs.sep` is required for relative reference");var rRelativePath_1=new RegExp(["."+sep,".."+sep,"./","../"].map((function(prefix){return function escapeRegex(str){return str.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}(prefix)})).join("|"));this.shouldLoadRelative=function(referencedFile){return rRelativePath_1.test(referencedFile)}}else this.shouldLoadRelative=function(referencedFile){return!1};this.contains=this.options.fs.contains||function(){return!0}}return Loader.prototype.lookup=function(file,type,sync,currentFile){var fs,dirs,_a,_b,filepath,_c,e_1_1,e_1,_d;return __generator(this,(function(_e){switch(_e.label){case 0:fs=this.options.fs,dirs=this.options[type],_e.label=1;case 1:_e.trys.push([1,8,9,10]),_a=__values(this.candidates(file,dirs,currentFile,type!==LookupType.Root)),_b=_a.next(),_e.label=2;case 2:return _b.done?[3,7]:(filepath=_b.value,sync?(_c=fs.existsSync(filepath),[3,5]):[3,3]);case 3:return[4,fs.exists(filepath)];case 4:_c=_e.sent(),_e.label=5;case 5:if(_c)return[2,filepath];_e.label=6;case 6:return _b=_a.next(),[3,2];case 7:return[3,10];case 8:return e_1_1=_e.sent(),e_1={error:e_1_1},[3,10];case 9:try{_b&&!_b.done&&(_d=_a.return)&&_d.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 10:throw this.lookupError(file,dirs)}}))},Loader.prototype.candidates=function(file,dirs,currentFile,enforceRoot){var _a,fs,extname,dirs_1,dirs_1_1,e_2_1,dirs_2,dirs_2_1,dir,referenced,e_3_1,filepath,e_2,_b,e_3,_c;return __generator(this,(function(_d){switch(_d.label){case 0:if(_a=this.options,fs=_a.fs,extname=_a.extname,!this.shouldLoadRelative(file)||!currentFile)return[3,8];referenced=fs.resolve(this.dirname(currentFile),file,extname),_d.label=1;case 1:_d.trys.push([1,6,7,8]),dirs_1=__values(dirs),dirs_1_1=dirs_1.next(),_d.label=2;case 2:return dirs_1_1.done?[3,5]:(dir=dirs_1_1.value,enforceRoot&&!this.contains(dir,referenced)?[3,4]:[4,referenced]);case 3:return _d.sent(),[3,5];case 4:return dirs_1_1=dirs_1.next(),[3,2];case 5:return[3,8];case 6:return e_2_1=_d.sent(),e_2={error:e_2_1},[3,8];case 7:try{dirs_1_1&&!dirs_1_1.done&&(_b=dirs_1.return)&&_b.call(dirs_1)}finally{if(e_2)throw e_2.error}return[7];case 8:_d.trys.push([8,13,14,15]),dirs_2=__values(dirs),dirs_2_1=dirs_2.next(),_d.label=9;case 9:return dirs_2_1.done?[3,12]:(dir=dirs_2_1.value,referenced=fs.resolve(dir,file,extname),enforceRoot&&!this.contains(dir,referenced)?[3,11]:[4,referenced]);case 10:_d.sent(),_d.label=11;case 11:return dirs_2_1=dirs_2.next(),[3,9];case 12:return[3,15];case 13:return e_3_1=_d.sent(),e_3={error:e_3_1},[3,15];case 14:try{dirs_2_1&&!dirs_2_1.done&&(_c=dirs_2.return)&&_c.call(dirs_2)}finally{if(e_3)throw e_3.error}return[7];case 15:return void 0===fs.fallback||void 0===(filepath=fs.fallback(file))?[3,17]:[4,filepath];case 16:_d.sent(),_d.label=17;case 17:return[2]}}))},Loader.prototype.dirname=function(path){var fs=this.options.fs;return assert(fs.dirname,"`fs.dirname` is required for relative reference"),fs.dirname(path)},Loader.prototype.lookupError=function(file,roots){var err=new Error("ENOENT");return err.message='ENOENT: Failed to lookup "'.concat(file,'" in "').concat(roots,'"'),err.code="ENOENT",err},Loader}(),SimpleEmitter=function(){function SimpleEmitter(){this.buffer=""}return SimpleEmitter.prototype.write=function(html){this.buffer+=stringify(html)},SimpleEmitter}(),StreamedEmitter=function StreamedEmitter(){throw this.buffer="",this.stream=null,new Error("streaming not supported in browser")};function createResolvedThenable(value){var ret={then:function(resolve){return resolve(value)},catch:function(){return ret}};return ret}function createRejectedThenable(err){var ret={then:function(resolve,reject){return reject?reject(err):ret},catch:function(reject){return reject(err)}};return ret}function toThenable(val){return function isThenable(val){return val&&isFunction(val.then)}(val)?val:function isAsyncIterator(val){return val&&isFunction(val.next)&&isFunction(val.throw)&&isFunction(val.return)}(val)?function reduce(prev){var state;try{state=val.next(prev)}catch(err){return createRejectedThenable(err)}return state.done?createResolvedThenable(state.value):toThenable(state.value).then(reduce,(function(err){var state;try{state=val.throw(err)}catch(e){return createRejectedThenable(e)}return state.done?createResolvedThenable(state.value):reduce(state.value)}))}():createResolvedThenable(val)}function toPromise(val){return Promise.resolve(toThenable(val))}function toValue(val){var ret;return toThenable(val).then((function(x){return createResolvedThenable(ret=x)})).catch((function(err){throw err})),ret}var TokenKind,KeepingTypeEmitter=function(){function KeepingTypeEmitter(){this.buffer=""}return KeepingTypeEmitter.prototype.write=function(html){"string"!=typeof(html=toValue$1(html))&&""===this.buffer?this.buffer=html:this.buffer=stringify(this.buffer)+stringify(html)},KeepingTypeEmitter}(),Render=function(){function Render(){}return Render.prototype.renderTemplatesToNodeStream=function(templates,ctx){var _this=this,emitter=new StreamedEmitter;return Promise.resolve().then((function(){return toThenable(_this.renderTemplates(templates,ctx,emitter))})).then((function(){return emitter.end()}),(function(err){return emitter.error(err)})),emitter.stream},Render.prototype.renderTemplates=function(templates,ctx,emitter){var templates_1,templates_1_1,tpl,html,e_1,e_2_1,e_2,_a;return __generator(this,(function(_b){switch(_b.label){case 0:emitter||(emitter=ctx.opts.keepOutputType?new KeepingTypeEmitter:new SimpleEmitter),_b.label=1;case 1:_b.trys.push([1,8,9,10]),templates_1=__values(templates),templates_1_1=templates_1.next(),_b.label=2;case 2:if(templates_1_1.done)return[3,7];tpl=templates_1_1.value,_b.label=3;case 3:return _b.trys.push([3,5,,6]),[4,tpl.render(ctx,emitter)];case 4:return(html=_b.sent())&&emitter.write(html),emitter.break||emitter.continue?[3,7]:[3,6];case 5:throw e_1=_b.sent(),RenderError.is(e_1)?e_1:new RenderError(e_1,tpl);case 6:return templates_1_1=templates_1.next(),[3,2];case 7:return[3,10];case 8:return e_2_1=_b.sent(),e_2={error:e_2_1},[3,10];case 9:try{templates_1_1&&!templates_1_1.done&&(_a=templates_1.return)&&_a.call(templates_1)}finally{if(e_2)throw e_2.error}return[7];case 10:return[2,emitter.buffer]}}))},Render}();function isDelimitedToken(val){return!!(getKind(val)&TokenKind.Delimited)}function isOperatorToken(val){return getKind(val)===TokenKind.Operator}function isHTMLToken(val){return getKind(val)===TokenKind.HTML}function isOutputToken(val){return getKind(val)===TokenKind.Output}function isTagToken(val){return getKind(val)===TokenKind.Tag}function isQuotedToken(val){return getKind(val)===TokenKind.Quoted}function isLiteralToken(val){return getKind(val)===TokenKind.Literal}function isNumberToken(val){return getKind(val)===TokenKind.Number}function isPropertyAccessToken(val){return getKind(val)===TokenKind.PropertyAccess}function isWordToken(val){return getKind(val)===TokenKind.Word}function isRangeToken(val){return getKind(val)===TokenKind.Range}function getKind(val){return val?val.kind:-1}!function(TokenKind){TokenKind[TokenKind.Number=1]="Number",TokenKind[TokenKind.Literal=2]="Literal",TokenKind[TokenKind.Tag=4]="Tag",TokenKind[TokenKind.Output=8]="Output",TokenKind[TokenKind.HTML=16]="HTML",TokenKind[TokenKind.Filter=32]="Filter",TokenKind[TokenKind.Hash=64]="Hash",TokenKind[TokenKind.PropertyAccess=128]="PropertyAccess",TokenKind[TokenKind.Word=256]="Word",TokenKind[TokenKind.Range=512]="Range",TokenKind[TokenKind.Quoted=1024]="Quoted",TokenKind[TokenKind.Operator=2048]="Operator",TokenKind[TokenKind.Delimited=12]="Delimited"}(TokenKind||(TokenKind={}));var ParseStream=function(){function ParseStream(tokens,parseToken){this.handlers={},this.stopRequested=!1,this.tokens=tokens,this.parseToken=parseToken}return ParseStream.prototype.on=function(name,cb){return this.handlers[name]=cb,this},ParseStream.prototype.trigger=function(event,arg){var h=this.handlers[event];return!!h&&(h.call(this,arg),!0)},ParseStream.prototype.start=function(){var token;for(this.trigger("start");!this.stopRequested&&(token=this.tokens.shift());)if(!(this.trigger("token",token)||isTagToken(token)&&this.trigger("tag:".concat(token.name),token))){var template=this.parseToken(token,this.tokens);this.trigger("template",template)}return this.stopRequested||this.trigger("end"),this},ParseStream.prototype.stop=function(){return this.stopRequested=!0,this},ParseStream}(),TemplateImpl=function TemplateImpl(token){this.token=token},NullDrop=function(_super){function NullDrop(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(NullDrop,_super),NullDrop.prototype.equals=function(value){return isNil(toValue$1(value))},NullDrop.prototype.gt=function(){return!1},NullDrop.prototype.geq=function(){return!1},NullDrop.prototype.lt=function(){return!1},NullDrop.prototype.leq=function(){return!1},NullDrop.prototype.valueOf=function(){return null},NullDrop}(Drop),EmptyDrop=function(_super){function EmptyDrop(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(EmptyDrop,_super),EmptyDrop.prototype.equals=function(value){return!(value instanceof EmptyDrop)&&(isString(value=toValue$1(value))||isArray(value)?0===value.length:!!isObject(value)&&0===Object.keys(value).length)},EmptyDrop.prototype.gt=function(){return!1},EmptyDrop.prototype.geq=function(){return!1},EmptyDrop.prototype.lt=function(){return!1},EmptyDrop.prototype.leq=function(){return!1},EmptyDrop.prototype.valueOf=function(){return""},EmptyDrop}(Drop),BlankDrop=function(_super){function BlankDrop(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BlankDrop,_super),BlankDrop.prototype.equals=function(value){return!1===value||(!!isNil(toValue$1(value))||(isString(value)?/^\s*$/.test(value):_super.prototype.equals.call(this,value)))},BlankDrop}(EmptyDrop),nil=new NullDrop,literalValues={true:!0,false:!1,nil,null:nil,empty:new EmptyDrop,blank:new BlankDrop},rHex=/[\da-fA-F]/,rOct=/[0-7]/,escapeChar={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v"};function hexVal(c){var code=c.charCodeAt(0);return code>=97?code-87:code>=65?code-55:code-48}function parseStringLiteral(str){for(var ret="",i=1;i<str.length-1;i++)if("\\"===str[i])if(void 0!==escapeChar[str[i+1]])ret+=escapeChar[str[++i]];else if("u"===str[i+1]){for(var val=0,j=i+2;j<=i+5&&rHex.test(str[j]);)val=16*val+hexVal(str[j++]);i=j-1,ret+=String.fromCharCode(val)}else if(rOct.test(str[i+1])){for(j=i+1,val=0;j<=i+3&&rOct.test(str[j]);)val=8*val+hexVal(str[j++]);i=j-1,ret+=String.fromCharCode(val)}else ret+=str[++i];else ret+=str[i];return ret}var Expression=function(){function Expression(tokens){this.postfix=__spreadArray([],__read(function toPostfix(tokens){var ops,tokens_1,tokens_1_1,token,e_2_1,e_2,_a;return __generator(this,(function(_b){switch(_b.label){case 0:ops=[],_b.label=1;case 1:_b.trys.push([1,10,11,12]),tokens_1=__values(tokens),tokens_1_1=tokens_1.next(),_b.label=2;case 2:if(tokens_1_1.done)return[3,9];if(!isOperatorToken(token=tokens_1_1.value))return[3,6];_b.label=3;case 3:return ops.length&&ops[ops.length-1].getPrecedence()>token.getPrecedence()?[4,ops.pop()]:[3,5];case 4:return _b.sent(),[3,3];case 5:return ops.push(token),[3,8];case 6:return[4,token];case 7:_b.sent(),_b.label=8;case 8:return tokens_1_1=tokens_1.next(),[3,2];case 9:return[3,12];case 10:return e_2_1=_b.sent(),e_2={error:e_2_1},[3,12];case 11:try{tokens_1_1&&!tokens_1_1.done&&(_a=tokens_1.return)&&_a.call(tokens_1)}finally{if(e_2)throw e_2.error}return[7];case 12:return ops.length?[4,ops.pop()]:[3,14];case 13:return _b.sent(),[3,12];case 14:return[2]}}))}(tokens)),!1)}return Expression.prototype.evaluate=function(ctx,lenient){var operands,_a,_b,token,r,l,result,_c,_d,e_1_1,e_1,_e;return __generator(this,(function(_f){switch(_f.label){case 0:assert(ctx,"unable to evaluate: context not defined"),operands=[],_f.label=1;case 1:_f.trys.push([1,9,10,11]),_a=__values(this.postfix),_b=_a.next(),_f.label=2;case 2:return _b.done?[3,8]:isOperatorToken(token=_b.value)?[4,operands.pop()]:[3,5];case 3:return r=_f.sent(),[4,operands.pop()];case 4:return l=_f.sent(),result=function evalOperatorToken(operators,token,lhs,rhs,ctx){var impl=operators[token.operator];return impl(lhs,rhs,ctx)}(ctx.opts.operators,token,l,r,ctx),operands.push(result),[3,7];case 5:return _d=(_c=operands).push,[4,evalToken(token,ctx,lenient&&1===this.postfix.length)];case 6:_d.apply(_c,[_f.sent()]),_f.label=7;case 7:return _b=_a.next(),[3,2];case 8:return[3,11];case 9:return e_1_1=_f.sent(),e_1={error:e_1_1},[3,11];case 10:try{_b&&!_b.done&&(_e=_a.return)&&_e.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 11:return[2,operands[0]]}}))},Expression}();function evalToken(token,ctx,lenient){return void 0===lenient&&(lenient=!1),isPropertyAccessToken(token)?function evalPropertyAccessToken(token,ctx,lenient){var props=token.props.map((function(prop){return evalToken(prop,ctx,!1)}));try{return ctx.get(__spreadArray([token.propertyName],__read(props),!1))}catch(e){if(lenient&&"InternalUndefinedVariableError"===e.name)return null;throw new UndefinedVariableError(e,token)}}(token,ctx,lenient):isRangeToken(token)?function evalRangeToken(token,ctx){var low=evalToken(token.lhs,ctx),high=evalToken(token.rhs,ctx);return range(+low,+high+1)}(token,ctx):isLiteralToken(token)?function evalLiteralToken(token){return literalValues[token.literal]}(token):isNumberToken(token)?function evalNumberToken(token){var str=token.whole.content+"."+(token.decimal?token.decimal.content:"");return Number(str)}(token):isWordToken(token)?token.getText():isQuotedToken(token)?evalQuotedToken(token):void 0}function evalQuotedToken(token){return parseStringLiteral(token.getText())}var Token=function(){function Token(kind,input,begin,end,file){this.kind=kind,this.input=input,this.begin=begin,this.end=end,this.file=file}return Token.prototype.getText=function(){return this.input.slice(this.begin,this.end)},Token.prototype.getPosition=function(){for(var _a=__read([1,1],2),row=_a[0],col=_a[1],i=0;i<this.begin;i++)"\n"===this.input[i]?(row++,col=1):col++;return[row,col]},Token.prototype.size=function(){return this.end-this.begin},Token}(),DelimitedToken=function(_super){function DelimitedToken(kind,content,input,begin,end,trimLeft,trimRight,file){var _this=_super.call(this,kind,input,begin,end,file)||this;_this.trimLeft=!1,_this.trimRight=!1,_this.content=_this.getText();var tl="-"===content[0],tr="-"===last$1(content);return _this.content=content.slice(tl?1:0,tr?-1:content.length).trim(),_this.trimLeft=tl||trimLeft,_this.trimRight=tr||trimRight,_this}return __extends(DelimitedToken,_super),DelimitedToken}(Token);function trimLeft(token,greedy){if(token&&isHTMLToken(token))for(var mask=greedy?BLANK:INLINE_BLANK;TYPES[token.input.charCodeAt(token.end-1-token.trimRight)]&mask;)token.trimRight++}function trimRight(token,greedy){if(token&&isHTMLToken(token)){for(var mask=greedy?BLANK:INLINE_BLANK;TYPES[token.input.charCodeAt(token.begin+token.trimLeft)]&mask;)token.trimLeft++;"\n"===token.input.charAt(token.begin+token.trimLeft)&&token.trimLeft++}}var NumberToken=function(_super){function NumberToken(whole,decimal){var _this=_super.call(this,TokenKind.Number,whole.input,whole.begin,decimal?decimal.end:whole.end,whole.file)||this;return _this.whole=whole,_this.decimal=decimal,_this}return __extends(NumberToken,_super),NumberToken}(Token),IdentifierToken=function(_super){function IdentifierToken(input,begin,end,file){var _this=_super.call(this,TokenKind.Word,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.file=file,_this.content=_this.getText(),_this}return __extends(IdentifierToken,_super),IdentifierToken.prototype.isNumber=function(allowSign){void 0===allowSign&&(allowSign=!1);for(var i=allowSign&&64&TYPES[this.input.charCodeAt(this.begin)]?this.begin+1:this.begin;i<this.end;i++)if(!(32&TYPES[this.input.charCodeAt(i)]))return!1;return!0},IdentifierToken}(Token),LiteralToken=function(_super){function LiteralToken(input,begin,end,file){var _this=_super.call(this,TokenKind.Literal,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.file=file,_this.literal=_this.getText(),_this}return __extends(LiteralToken,_super),LiteralToken}(Token),precedence={"==":1,"!=":1,">":1,"<":1,">=":1,"<=":1,contains:1,and:0,or:0},OperatorToken=function(_super){function OperatorToken(input,begin,end,file){var _this=_super.call(this,TokenKind.Operator,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.file=file,_this.operator=_this.getText(),_this}return __extends(OperatorToken,_super),OperatorToken.prototype.getPrecedence=function(){var key=this.getText();return key in precedence?precedence[key]:1},OperatorToken}(Token),PropertyAccessToken=function(_super){function PropertyAccessToken(variable,props,end){var _this=_super.call(this,TokenKind.PropertyAccess,variable.input,variable.begin,end,variable.file)||this;return _this.variable=variable,_this.props=props,_this.propertyName=_this.variable instanceof IdentifierToken?_this.variable.getText():parseStringLiteral(_this.variable.getText()),_this}return __extends(PropertyAccessToken,_super),PropertyAccessToken}(Token),FilterToken=function(_super){function FilterToken(name,args,input,begin,end,file){var _this=_super.call(this,TokenKind.Filter,input,begin,end,file)||this;return _this.name=name,_this.args=args,_this}return __extends(FilterToken,_super),FilterToken}(Token),HashToken=function(_super){function HashToken(input,begin,end,name,value,file){var _this=_super.call(this,TokenKind.Hash,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.name=name,_this.value=value,_this.file=file,_this}return __extends(HashToken,_super),HashToken}(Token),QuotedToken=function(_super){function QuotedToken(input,begin,end,file){var _this=_super.call(this,TokenKind.Quoted,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.file=file,_this}return __extends(QuotedToken,_super),QuotedToken}(Token),HTMLToken=function(_super){function HTMLToken(input,begin,end,file){var _this=_super.call(this,TokenKind.HTML,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.file=file,_this.trimLeft=0,_this.trimRight=0,_this}return __extends(HTMLToken,_super),HTMLToken.prototype.getContent=function(){return this.input.slice(this.begin+this.trimLeft,this.end-this.trimRight)},HTMLToken}(Token),RangeToken=function(_super){function RangeToken(input,begin,end,lhs,rhs,file){var _this=_super.call(this,TokenKind.Range,input,begin,end,file)||this;return _this.input=input,_this.begin=begin,_this.end=end,_this.lhs=lhs,_this.rhs=rhs,_this.file=file,_this}return __extends(RangeToken,_super),RangeToken}(Token),OutputToken=function(_super){function OutputToken(input,begin,end,options,file){var trimOutputLeft=options.trimOutputLeft,trimOutputRight=options.trimOutputRight,outputDelimiterLeft=options.outputDelimiterLeft,outputDelimiterRight=options.outputDelimiterRight,value=input.slice(begin+outputDelimiterLeft.length,end-outputDelimiterRight.length);return _super.call(this,TokenKind.Output,value,input,begin,end,trimOutputLeft,trimOutputRight,file)||this}return __extends(OutputToken,_super),OutputToken}(DelimitedToken);var Tokenizer=function(){function Tokenizer(input,trie,file){void 0===file&&(file=""),this.input=input,this.trie=trie,this.file=file,this.p=0,this.rawBeginAt=-1,this.N=input.length}return Tokenizer.prototype.readExpression=function(){return new Expression(this.readExpressionTokens())},Tokenizer.prototype.readExpressionTokens=function(){var operand,operator,operand_1;return __generator(this,(function(_a){switch(_a.label){case 0:return(operand=this.readValue())?[4,operand]:[2];case 1:_a.sent(),_a.label=2;case 2:return this.p<this.N?(operator=this.readOperator())&&(operand_1=this.readValue())?[4,operator]:[2]:[3,5];case 3:return _a.sent(),[4,operand_1];case 4:return _a.sent(),[3,2];case 5:return[2]}}))},Tokenizer.prototype.readOperator=function(){this.skipBlank();var end=function matchOperator(str,begin,trie,end){void 0===end&&(end=str.length);for(var info,node=trie,i=begin;node[str[i]]&&i<end;)(node=node[str[i++]]).end&&(info=node);return info?info.needBoundary&&TYPES[str.charCodeAt(i)]&IDENTIFIER?-1:i:-1}(this.input,this.p,this.trie,this.p+8);if(-1!==end)return new OperatorToken(this.input,this.p,this.p=end,this.file)},Tokenizer.prototype.readFilters=function(){for(var filters=[];;){var filter=this.readFilter();if(!filter)return filters;filters.push(filter)}},Tokenizer.prototype.readFilter=function(){var _this=this;if(this.skipBlank(),this.end())return null;assert("|"===this.peek(),(function(){return"unexpected token at ".concat(_this.snapshot())})),this.p++;var begin=this.p,name=this.readIdentifier();if(!name.size())return null;var args=[];if(this.skipBlank(),":"===this.peek())do{++this.p;var arg=this.readFilterArg();for(arg&&args.push(arg);this.p<this.N&&","!==this.peek()&&"|"!==this.peek();)++this.p}while(","===this.peek());return new FilterToken(name.getText(),args,this.input,begin,this.p,this.file)},Tokenizer.prototype.readFilterArg=function(){var key=this.readValue();if(key){if(this.skipBlank(),":"!==this.peek())return key;++this.p;var value=this.readValue();return[key.getText(),value]}},Tokenizer.prototype.readTopLevelTokens=function(options){void 0===options&&(options=defaultOptions);for(var tokens=[];this.p<this.N;){var token=this.readTopLevelToken(options);tokens.push(token)}return function whiteSpaceCtrl(tokens,options){for(var inRaw=!1,i=0;i<tokens.length;i++){var token=tokens[i];isDelimitedToken(token)&&(!inRaw&&token.trimLeft&&trimLeft(tokens[i-1],options.greedy),isTagToken(token)&&("raw"===token.name?inRaw=!0:"endraw"===token.name&&(inRaw=!1)),!inRaw&&token.trimRight&&trimRight(tokens[i+1],options.greedy))}}(tokens,options),tokens},Tokenizer.prototype.readTopLevelToken=function(options){var tagDelimiterLeft=options.tagDelimiterLeft,outputDelimiterLeft=options.outputDelimiterLeft;return this.rawBeginAt>-1?this.readEndrawOrRawContent(options):this.match(tagDelimiterLeft)?this.readTagToken(options):this.match(outputDelimiterLeft)?this.readOutputToken(options):this.readHTMLToken(options)},Tokenizer.prototype.readHTMLToken=function(options){for(var begin=this.p;this.p<this.N;){var tagDelimiterLeft=options.tagDelimiterLeft,outputDelimiterLeft=options.outputDelimiterLeft;if(this.match(tagDelimiterLeft))break;if(this.match(outputDelimiterLeft))break;++this.p}return new HTMLToken(this.input,begin,this.p,this.file)},Tokenizer.prototype.readTagToken=function(options){void 0===options&&(options=defaultOptions);var file=this.file,input=this.input,begin=this.p;if(-1===this.readToDelimiter(options.tagDelimiterRight))throw this.mkError("tag ".concat(this.snapshot(begin)," not closed"),begin);var token=new TagToken(input,begin,this.p,options,file);return"raw"===token.name&&(this.rawBeginAt=begin),token},Tokenizer.prototype.readToDelimiter=function(delimiter){for(;this.p<this.N;)if(8&this.peekType())this.readQuoted();else if(++this.p,this.rmatch(delimiter))return this.p;return-1},Tokenizer.prototype.readOutputToken=function(options){void 0===options&&(options=defaultOptions);var file=this.file,input=this.input,outputDelimiterRight=options.outputDelimiterRight,begin=this.p;if(-1===this.readToDelimiter(outputDelimiterRight))throw this.mkError("output ".concat(this.snapshot(begin)," not closed"),begin);return new OutputToken(input,begin,this.p,options,file)},Tokenizer.prototype.readEndrawOrRawContent=function(options){for(var tagDelimiterLeft=options.tagDelimiterLeft,tagDelimiterRight=options.tagDelimiterRight,begin=this.p,leftPos=this.readTo(tagDelimiterLeft)-tagDelimiterLeft.length;this.p<this.N;)if("endraw"===this.readIdentifier().getText())for(;this.p<=this.N;){if(this.rmatch(tagDelimiterRight)){var end=this.p;return begin===leftPos?(this.rawBeginAt=-1,new TagToken(this.input,begin,end,options,this.file)):(this.p=leftPos,new HTMLToken(this.input,begin,leftPos,this.file))}if(this.rmatch(tagDelimiterLeft))break;this.p++}else leftPos=this.readTo(tagDelimiterLeft)-tagDelimiterLeft.length;throw this.mkError("raw ".concat(this.snapshot(this.rawBeginAt)," not closed"),begin)},Tokenizer.prototype.mkError=function(msg,begin){return new TokenizationError(msg,new IdentifierToken(this.input,begin,this.N,this.file))},Tokenizer.prototype.snapshot=function(begin){return void 0===begin&&(begin=this.p),JSON.stringify(function ellipsis(str,N){return str.length>N?str.substr(0,N-3)+"...":str}(this.input.slice(begin),16))},Tokenizer.prototype.readWord=function(){return console.warn("Tokenizer#readWord() will be removed, use #readIdentifier instead"),this.readIdentifier()},Tokenizer.prototype.readIdentifier=function(){this.skipBlank();for(var begin=this.p;this.peekType()&IDENTIFIER;)++this.p;return new IdentifierToken(this.input,begin,this.p,this.file)},Tokenizer.prototype.readHashes=function(){for(var hashes=[];;){var hash=this.readHash();if(!hash)return hashes;hashes.push(hash)}},Tokenizer.prototype.readHash=function(){this.skipBlank(),","===this.peek()&&++this.p;var value,begin=this.p,name=this.readIdentifier();if(name.size())return this.skipBlank(),":"===this.peek()&&(++this.p,value=this.readValue()),new HashToken(this.input,begin,this.p,name,value,this.file)},Tokenizer.prototype.remaining=function(){return this.input.slice(this.p)},Tokenizer.prototype.advance=function(i){void 0===i&&(i=1),this.p+=i},Tokenizer.prototype.end=function(){return this.p>=this.N},Tokenizer.prototype.readTo=function(end){for(;this.p<this.N;)if(++this.p,this.rmatch(end))return this.p;return-1},Tokenizer.prototype.readValue=function(){var value=this.readQuoted()||this.readRange();if(value)return value;if("["===this.peek()){if(this.p++,!(prop=this.readQuoted()))return;if("]"!==this.peek())return;return this.p++,new PropertyAccessToken(prop,[],this.p)}var variable=this.readIdentifier();if(variable.size()){for(var isNumber=variable.isNumber(!0),props=[];;)if("["===this.peek()){isNumber=!1,this.p++;var prop=this.readValue()||new IdentifierToken(this.input,this.p,this.p,this.file);this.readTo("]"),props.push(prop)}else{if("."!==this.peek()||"."===this.peek(1))break;if(this.p++,!(prop=this.readIdentifier()).size())break;prop.isNumber()||(isNumber=!1),props.push(prop)}return!props.length&&literalValues.hasOwnProperty(variable.content)?new LiteralToken(this.input,variable.begin,variable.end,this.file):isNumber?new NumberToken(variable,props[0]):new PropertyAccessToken(variable,props,this.p)}},Tokenizer.prototype.readRange=function(){this.skipBlank();var begin=this.p;if("("===this.peek()){++this.p;var lhs=this.readValueOrThrow();this.p+=2;var rhs=this.readValueOrThrow();return++this.p,new RangeToken(this.input,begin,this.p,lhs,rhs,this.file)}},Tokenizer.prototype.readValueOrThrow=function(){var _this=this,value=this.readValue();return assert(value,(function(){return"unexpected token ".concat(_this.snapshot(),", value expected")})),value},Tokenizer.prototype.readQuoted=function(){this.skipBlank();var begin=this.p;if(8&this.peekType()){++this.p;for(var escaped=!1;this.p<this.N&&(++this.p,this.input[this.p-1]!==this.input[begin]||escaped);)escaped?escaped=!1:"\\"===this.input[this.p-1]&&(escaped=!0);return new QuotedToken(this.input,begin,this.p,this.file)}},Tokenizer.prototype.readFileName=function(){for(var begin=this.p;!(this.peekType()&BLANK)&&","!==this.peek()&&this.p<this.N;)this.p++;return new IdentifierToken(this.input,begin,this.p,this.file)},Tokenizer.prototype.match=function(word){for(var i=0;i<word.length;i++)if(word[i]!==this.input[this.p+i])return!1;return!0},Tokenizer.prototype.rmatch=function(pattern){for(var i=0;i<pattern.length;i++)if(pattern[pattern.length-1-i]!==this.input[this.p-1-i])return!1;return!0},Tokenizer.prototype.peekType=function(n){return void 0===n&&(n=0),TYPES[this.input.charCodeAt(this.p+n)]},Tokenizer.prototype.peek=function(n){return void 0===n&&(n=0),this.input[this.p+n]},Tokenizer.prototype.skipBlank=function(){for(;this.peekType()&BLANK;)++this.p},Tokenizer}(),TagToken=function(_super){function TagToken(input,begin,end,options,file){var _this=this,trimTagLeft=options.trimTagLeft,trimTagRight=options.trimTagRight,tagDelimiterLeft=options.tagDelimiterLeft,tagDelimiterRight=options.tagDelimiterRight,value=input.slice(begin+tagDelimiterLeft.length,end-tagDelimiterRight.length);_this=_super.call(this,TokenKind.Tag,value,input,begin,end,trimTagLeft,trimTagRight,file)||this;var tokenizer=new Tokenizer(_this.content,options.operatorsTrie);if(_this.name=tokenizer.readIdentifier().getText(),!_this.name)throw new TokenizationError("illegal tag syntax",_this);return tokenizer.skipBlank(),_this.args=tokenizer.remaining(),_this}return __extends(TagToken,_super),TagToken}(DelimitedToken),Hash=function(){function Hash(markup){var e_1,_a;this.hash={};var tokenizer=new Tokenizer(markup,{});try{for(var _b=__values(tokenizer.readHashes()),_c=_b.next();!_c.done;_c=_b.next()){var hash=_c.value;this.hash[hash.name.content]=hash.value}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}}return Hash.prototype.render=function(ctx){var hash,_a,_b,key,_c,_d,_e,e_2_1,e_2,_f;return __generator(this,(function(_g){switch(_g.label){case 0:hash={},_g.label=1;case 1:_g.trys.push([1,8,9,10]),_a=__values(Object.keys(this.hash)),_b=_a.next(),_g.label=2;case 2:return _b.done?[3,7]:(key=_b.value,_c=hash,_d=key,void 0!==this.hash[key]?[3,3]:(_e=!0,[3,5]));case 3:return[4,evalToken(this.hash[key],ctx)];case 4:_e=_g.sent(),_g.label=5;case 5:_c[_d]=_e,_g.label=6;case 6:return _b=_a.next(),[3,2];case 7:return[3,10];case 8:return e_2_1=_g.sent(),e_2={error:e_2_1},[3,10];case 9:try{_b&&!_b.done&&(_f=_a.return)&&_f.call(_a)}finally{if(e_2)throw e_2.error}return[7];case 10:return[2,hash]}}))},Hash}();var Filter=function(){function Filter(name,impl,args,liquid){this.name=name,this.impl=impl||identify,this.args=args,this.liquid=liquid}return Filter.prototype.render=function(value,context){var e_1,_a,argv=[];try{for(var _b=__values(this.args),_c=_b.next();!_c.done;_c=_b.next()){var arg=_c.value;isArray(arg)?argv.push([arg[0],evalToken(arg[1],context)]):argv.push(evalToken(arg,context))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_1)throw e_1.error}}return this.impl.apply({context,liquid:this.liquid},__spreadArray([value],__read(argv),!1))},Filter}(),Value=function(){function Value(str,liquid){this.filters=[];var tokenizer=new Tokenizer(str,liquid.options.operatorsTrie);this.initial=tokenizer.readExpression(),this.filters=tokenizer.readFilters().map((function(_a){var name=_a.name,args=_a.args;return new Filter(name,liquid.filters.get(name),args,liquid)}))}return Value.prototype.value=function(ctx,lenient){var val,_a,_b,e_1_1,e_1,_c;return __generator(this,(function(_d){switch(_d.label){case 0:return lenient=lenient||ctx.opts.lenientIf&&this.filters.length>0&&"default"===this.filters[0].name,[4,this.initial.evaluate(ctx,lenient)];case 1:val=_d.sent(),_d.label=2;case 2:_d.trys.push([2,7,8,9]),_a=__values(this.filters),_b=_a.next(),_d.label=3;case 3:return _b.done?[3,6]:[4,_b.value.render(val,ctx)];case 4:val=_d.sent(),_d.label=5;case 5:return _b=_a.next(),[3,3];case 6:return[3,9];case 7:return e_1_1=_d.sent(),e_1={error:e_1_1},[3,9];case 8:try{_b&&!_b.done&&(_c=_a.return)&&_c.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 9:return[2,val]}}))},Value}(),Tag=function(_super){function Tag(token,tokens,liquid){var _this=_super.call(this,token)||this;_this.name=token.name;var impl=liquid.tags.get(token.name);return _this.impl=Object.create(impl),_this.impl.liquid=liquid,_this.impl.parse&&_this.impl.parse(token,tokens),_this}return __extends(Tag,_super),Tag.prototype.render=function(ctx,emitter){var hash,impl;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,new Hash(this.token.args).render(ctx)];case 1:return hash=_a.sent(),isFunction((impl=this.impl).render)?[4,impl.render(ctx,emitter,hash)]:[3,3];case 2:return[2,_a.sent()];case 3:return[2]}}))},Tag}(TemplateImpl),Output=function(_super){function Output(token,liquid){var _this=_super.call(this,token)||this;return _this.value=new Value(token.content,liquid),_this}return __extends(Output,_super),Output.prototype.render=function(ctx,emitter){var val;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.value.value(ctx,!1)];case 1:return val=_a.sent(),emitter.write(val),[2]}}))},Output}(TemplateImpl),HTML=function(_super){function HTML(token){var _this=_super.call(this,token)||this;return _this.str=token.getContent(),_this}return __extends(HTML,_super),HTML.prototype.render=function(ctx,emitter){return __generator(this,(function(_a){return emitter.write(this.str),[2]}))},HTML}(TemplateImpl),Parser=function(){function Parser(liquid){this.liquid=liquid,this.cache=this.liquid.options.cache,this.fs=this.liquid.options.fs,this.parseFile=this.cache?this._parseFileCached:this._parseFile,this.loader=new Loader(this.liquid.options)}return Parser.prototype.parse=function(html,filepath){var tokens=new Tokenizer(html,this.liquid.options.operatorsTrie,filepath).readTopLevelTokens(this.liquid.options);return this.parseTokens(tokens)},Parser.prototype.parseTokens=function(tokens){for(var token,templates=[];token=tokens.shift();)templates.push(this.parseToken(token,tokens));return templates},Parser.prototype.parseToken=function(token,remainTokens){try{return isTagToken(token)?new Tag(token,remainTokens,this.liquid):isOutputToken(token)?new Output(token,this.liquid):new HTML(token)}catch(e){throw new ParseError(e,token)}},Parser.prototype.parseStream=function(tokens){var _this=this;return new ParseStream(tokens,(function(token,tokens){return _this.parseToken(token,tokens)}))},Parser.prototype._parseFileCached=function(file,sync,type,currentFile){var key,tpls,task;return void 0===type&&(type=LookupType.Root),__generator(this,(function(_a){switch(_a.label){case 0:return key=this.loader.shouldLoadRelative(file)?currentFile+","+file:type+":"+file,[4,this.cache.read(key)];case 1:if(tpls=_a.sent())return[2,tpls];task=toThenable(this._parseFile(file,sync,type,currentFile)),this.cache.write(key,task),_a.label=2;case 2:return _a.trys.push([2,4,,5]),[4,task];case 3:return[2,_a.sent()];case 4:return _a.sent(),this.cache.remove(key),[3,5];case 5:return[2,[]]}}))},Parser.prototype._parseFile=function(file,sync,type,currentFile){var filepath,_a,_b,_c;return void 0===type&&(type=LookupType.Root),__generator(this,(function(_d){switch(_d.label){case 0:return[4,this.loader.lookup(file,type,sync,currentFile)];case 1:return filepath=_d.sent(),_b=(_a=this.liquid).parse,sync?(_c=this.fs.readFileSync(filepath),[3,4]):[3,2];case 2:return[4,this.fs.readFile(filepath)];case 3:_c=_d.sent(),_d.label=4;case 4:return[2,_b.apply(_a,[_c,filepath])]}}))},Parser}(),assign={parse:function(token){var tokenizer=new Tokenizer(token.args,this.liquid.options.operatorsTrie);this.key=tokenizer.readIdentifier().content,tokenizer.skipBlank(),assert("="===tokenizer.peek(),(function(){return"illegal token ".concat(token.getText())})),tokenizer.advance(),this.value=tokenizer.remaining()},render:function(ctx){var _a,_b;return __generator(this,(function(_c){switch(_c.label){case 0:return _a=ctx.bottom(),_b=this.key,[4,this.liquid._evalValue(this.value,ctx)];case 1:return _a[_b]=_c.sent(),[2]}}))}};function toEnumerable(val){return isArray(val)?val:isString(val)&&val.length>0?[val]:isObject(val)?Object.keys(val).map((function(key){return[key,val[key]]})):[]}function toArray(val){return isArray(val)?val:[val]}var ForloopDrop=function(_super){function ForloopDrop(length,collection,variable){var _this=_super.call(this)||this;return _this.i=0,_this.length=length,_this.name="".concat(variable,"-").concat(collection),_this}return __extends(ForloopDrop,_super),ForloopDrop.prototype.next=function(){this.i++},ForloopDrop.prototype.index0=function(){return this.i},ForloopDrop.prototype.index=function(){return this.i+1},ForloopDrop.prototype.first=function(){return 0===this.i},ForloopDrop.prototype.last=function(){return this.i===this.length-1},ForloopDrop.prototype.rindex=function(){return this.length-this.i},ForloopDrop.prototype.rindex0=function(){return this.length-this.i-1},ForloopDrop.prototype.valueOf=function(){return JSON.stringify(this)},ForloopDrop}(Drop),MODIFIERS=["offset","limit","reversed"],For={type:"block",parse:function(token,remainTokens){var p,_this=this,tokenizer=new Tokenizer(token.args,this.liquid.options.operatorsTrie),variable=tokenizer.readIdentifier(),inStr=tokenizer.readIdentifier(),collection=tokenizer.readValue();assert(variable.size()&&"in"===inStr.content&&collection,(function(){return"illegal tag: ".concat(token.getText())})),this.variable=variable.content,this.collection=collection,this.hash=new Hash(tokenizer.remaining()),this.templates=[],this.elseTemplates=[];var stream=this.liquid.parser.parseStream(remainTokens).on("start",(function(){return p=_this.templates})).on("tag:else",(function(){return p=_this.elseTemplates})).on("tag:endfor",(function(){return stream.stop()})).on("template",(function(tpl){return p.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(token.getText()," not closed"))}));stream.start()},render:function(ctx,emitter){var r,collection,_a,hash,modifiers,scope,collection_1,collection_1_1,item,e_1_1,e_1,_b;return __generator(this,(function(_c){switch(_c.label){case 0:return r=this.liquid.renderer,_a=toEnumerable,[4,evalToken(this.collection,ctx)];case 1:return(collection=_a.apply(void 0,[_c.sent()])).length?[3,3]:[4,r.renderTemplates(this.elseTemplates,ctx,emitter)];case 2:return _c.sent(),[2];case 3:return[4,this.hash.render(ctx)];case 4:hash=_c.sent(),modifiers=this.liquid.options.orderedFilterParameters?Object.keys(hash).filter((function(x){return MODIFIERS.includes(x)})):MODIFIERS.filter((function(x){return void 0!==hash[x]})),collection=modifiers.reduce((function(collection,modifier){return"offset"===modifier?function offset(arr,count){return arr.slice(count)}(collection,hash.offset):"limit"===modifier?function limit(arr,count){return arr.slice(0,count)}(collection,hash.limit):function reversed(arr){return __spreadArray([],__read(arr),!1).reverse()}(collection)}),collection),scope={forloop:new ForloopDrop(collection.length,this.collection.getText(),this.variable)},ctx.push(scope),_c.label=5;case 5:_c.trys.push([5,10,11,12]),collection_1=__values(collection),collection_1_1=collection_1.next(),_c.label=6;case 6:return collection_1_1.done?[3,9]:(item=collection_1_1.value,scope[this.variable]=item,[4,r.renderTemplates(this.templates,ctx,emitter)]);case 7:if(_c.sent(),emitter.break)return emitter.break=!1,[3,9];emitter.continue=!1,scope.forloop.next(),_c.label=8;case 8:return collection_1_1=collection_1.next(),[3,6];case 9:return[3,12];case 10:return e_1_1=_c.sent(),e_1={error:e_1_1},[3,12];case 11:try{collection_1_1&&!collection_1_1.done&&(_b=collection_1.return)&&_b.call(collection_1)}finally{if(e_1)throw e_1.error}return[7];case 12:return ctx.pop(),[2]}}))}};var capture={parse:function(tagToken,remainTokens){var _this=this,tokenizer=new Tokenizer(tagToken.args,this.liquid.options.operatorsTrie);this.variable=function readVariableName(tokenizer){var word=tokenizer.readIdentifier().content;if(word)return word;var quoted=tokenizer.readQuoted();if(quoted)return evalQuotedToken(quoted)}(tokenizer),assert(this.variable,(function(){return"".concat(tagToken.args," not valid identifier")})),this.templates=[];var stream=this.liquid.parser.parseStream(remainTokens);stream.on("tag:endcapture",(function(){return stream.stop()})).on("template",(function(tpl){return _this.templates.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))})),stream.start()},render:function(ctx){var html;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.liquid.renderer.renderTemplates(this.templates,ctx)];case 1:return html=_a.sent(),ctx.bottom()[this.variable]=html,[2]}}))}};var BlockMode,Case={parse:function(tagToken,remainTokens){var _this=this;this.cond=new Value(tagToken.args,this.liquid),this.cases=[],this.elseTemplates=[];var p=[],stream=this.liquid.parser.parseStream(remainTokens).on("tag:when",(function(token){p=[];for(var tokenizer=new Tokenizer(token.args,_this.liquid.options.operatorsTrie);!tokenizer.end();){var value=tokenizer.readValue();_this.cases.push({val:value,templates:p}),tokenizer.readTo(",")}})).on("tag:else",(function(){return p=_this.elseTemplates})).on("tag:endcase",(function(){return stream.stop()})).on("template",(function(tpl){return p.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))}));stream.start()},render:function(ctx,emitter){var r,cond,_a,_b,_c,branch,e_1_1,e_1,_d;return __generator(this,(function(_e){switch(_e.label){case 0:return r=this.liquid.renderer,_a=toValue$1,[4,this.cond.value(ctx,ctx.opts.lenientIf)];case 1:cond=_a.apply(void 0,[_e.sent()]),_e.label=2;case 2:_e.trys.push([2,7,8,9]),_b=__values(this.cases),_c=_b.next(),_e.label=3;case 3:return _c.done?[3,6]:(branch=_c.value,evalToken(branch.val,ctx,ctx.opts.lenientIf)!==cond?[3,5]:[4,r.renderTemplates(branch.templates,ctx,emitter)]);case 4:return _e.sent(),[2];case 5:return _c=_b.next(),[3,3];case 6:return[3,9];case 7:return e_1_1=_e.sent(),e_1={error:e_1_1},[3,9];case 8:try{_c&&!_c.done&&(_d=_b.return)&&_d.call(_b)}finally{if(e_1)throw e_1.error}return[7];case 9:return[4,r.renderTemplates(this.elseTemplates,ctx,emitter)];case 10:return _e.sent(),[2]}}))}},comment={parse:function(tagToken,remainTokens){var stream=this.liquid.parser.parseStream(remainTokens);stream.on("token",(function(token){"endcomment"===token.name&&stream.stop()})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))})),stream.start()}};!function(BlockMode){BlockMode[BlockMode.OUTPUT=0]="OUTPUT",BlockMode[BlockMode.STORE=1]="STORE"}(BlockMode||(BlockMode={}));var BlockMode$1=BlockMode,render={parseFilePath,renderFilePath,parse:function(token){var args=token.args,tokenizer=new Tokenizer(args,this.liquid.options.operatorsTrie);for(this.file=this.parseFilePath(tokenizer,this.liquid),this.currentFile=token.file;!tokenizer.end();){tokenizer.skipBlank();var begin=tokenizer.p,keyword=tokenizer.readIdentifier();if(("with"===keyword.content||"for"===keyword.content)&&(tokenizer.skipBlank(),":"!==tokenizer.peek())){var value=tokenizer.readValue();if(value){var beforeAs=tokenizer.p,alias=void 0;"as"===tokenizer.readIdentifier().content?alias=tokenizer.readIdentifier():tokenizer.p=beforeAs,this[keyword.content]={value,alias:alias&&alias.content},tokenizer.skipBlank(),","===tokenizer.peek()&&tokenizer.advance();continue}}tokenizer.p=begin;break}this.hash=new Hash(tokenizer.remaining())},render:function(ctx,emitter){var _a,liquid,hash,filepath,childCtx,scope,_b,_c,_d,_e,value,alias,collection,collection_1,collection_1_1,item,e_1_1,templates,e_1,_f;return __generator(this,(function(_g){switch(_g.label){case 0:return liquid=(_a=this).liquid,hash=_a.hash,[4,this.renderFilePath(this.file,ctx,liquid)];case 1:return assert(filepath=_g.sent(),(function(){return'illegal filename "'.concat(filepath,'"')})),childCtx=new Context({},ctx.opts,{sync:ctx.sync,globals:ctx.globals,strictVariables:ctx.strictVariables}),scope=childCtx.bottom(),_b=__assign,_c=[scope],[4,hash.render(ctx)];case 2:if(_b.apply(void 0,_c.concat([_g.sent()])),this.with&&(_d=this.with,value=_d.value,alias=_d.alias,scope[alias||filepath]=evalToken(value,ctx)),!this.for)return[3,12];_e=this.for,value=_e.value,alias=_e.alias,collection=toEnumerable(collection=evalToken(value,ctx)),scope.forloop=new ForloopDrop(collection.length,value.getText(),alias),_g.label=3;case 3:_g.trys.push([3,9,10,11]),collection_1=__values(collection),collection_1_1=collection_1.next(),_g.label=4;case 4:return collection_1_1.done?[3,8]:(item=collection_1_1.value,scope[alias]=item,[4,liquid._parsePartialFile(filepath,childCtx.sync,this.currentFile)]);case 5:return templates=_g.sent(),[4,liquid.renderer.renderTemplates(templates,childCtx,emitter)];case 6:_g.sent(),scope.forloop.next(),_g.label=7;case 7:return collection_1_1=collection_1.next(),[3,4];case 8:return[3,11];case 9:return e_1_1=_g.sent(),e_1={error:e_1_1},[3,11];case 10:try{collection_1_1&&!collection_1_1.done&&(_f=collection_1.return)&&_f.call(collection_1)}finally{if(e_1)throw e_1.error}return[7];case 11:return[3,15];case 12:return[4,liquid._parsePartialFile(filepath,childCtx.sync,this.currentFile)];case 13:return templates=_g.sent(),[4,liquid.renderer.renderTemplates(templates,childCtx,emitter)];case 14:_g.sent(),_g.label=15;case 15:return[2]}}))}};function parseFilePath(tokenizer,liquid){if(liquid.options.dynamicPartials){var file=tokenizer.readValue();if(void 0===file)throw new TypeError('illegal argument "'.concat(tokenizer.input,'"'));if("none"===file.getText())return null;if(isQuotedToken(file)){var tpls=liquid.parse(evalQuotedToken(file));return 1===tpls.length&&isHTMLToken(tpls[0].token)?tpls[0].token.getContent():tpls}return file}var filepath=tokenizer.readFileName().getText();return"none"===filepath?null:filepath}function renderFilePath(file,ctx,liquid){return"string"==typeof file?file:Array.isArray(file)?liquid.renderer.renderTemplates(file,ctx):evalToken(file,ctx)}var include={parseFilePath,renderFilePath,parse:function(token){var args=token.args,tokenizer=new Tokenizer(args,this.liquid.options.operatorsTrie);this.file=this.parseFilePath(tokenizer,this.liquid),this.currentFile=token.file;var begin=tokenizer.p;"with"===tokenizer.readIdentifier().content?(tokenizer.skipBlank(),":"!==tokenizer.peek()?this.withVar=tokenizer.readValue():tokenizer.p=begin):tokenizer.p=begin,this.hash=new Hash(tokenizer.remaining())},render:function(ctx,emitter){var _a,liquid,hash,withVar,renderer,filepath,saved,scope,templates;return __generator(this,(function(_b){switch(_b.label){case 0:return liquid=(_a=this).liquid,hash=_a.hash,withVar=_a.withVar,renderer=liquid.renderer,[4,this.renderFilePath(this.file,ctx,liquid)];case 1:return assert(filepath=_b.sent(),(function(){return'illegal filename "'.concat(filepath,'"')})),saved=ctx.saveRegister("blocks","blockMode"),ctx.setRegister("blocks",{}),ctx.setRegister("blockMode",BlockMode$1.OUTPUT),[4,hash.render(ctx)];case 2:return scope=_b.sent(),withVar&&(scope[filepath]=evalToken(withVar,ctx)),[4,liquid._parsePartialFile(filepath,ctx.sync,this.currentFile)];case 3:return templates=_b.sent(),ctx.push(scope),[4,renderer.renderTemplates(templates,ctx,emitter)];case 4:return _b.sent(),ctx.pop(),ctx.restoreRegister(saved),[2]}}))}},decrement={parse:function(token){var tokenizer=new Tokenizer(token.args,this.liquid.options.operatorsTrie);this.variable=tokenizer.readIdentifier().content},render:function(context,emitter){var scope=context.environments;isNumber(scope[this.variable])||(scope[this.variable]=0),emitter.write(stringify(--scope[this.variable]))}},cycle={parse:function(tagToken){var tokenizer=new Tokenizer(tagToken.args,this.liquid.options.operatorsTrie),group=tokenizer.readValue();for(tokenizer.skipBlank(),this.candidates=[],group&&(":"===tokenizer.peek()?(this.group=group,tokenizer.advance()):this.candidates.push(group));!tokenizer.end();){var value=tokenizer.readValue();value&&this.candidates.push(value),tokenizer.readTo(",")}assert(this.candidates.length,(function(){return"empty candidates: ".concat(tagToken.getText())}))},render:function(ctx,emitter){var group=evalToken(this.group,ctx),fingerprint="cycle:".concat(group,":")+this.candidates.join(","),groups=ctx.getRegister("cycle"),idx=groups[fingerprint];void 0===idx&&(idx=groups[fingerprint]=0);var candidate=this.candidates[idx];idx=(idx+1)%this.candidates.length,groups[fingerprint]=idx;var html=evalToken(candidate,ctx);emitter.write(html)}},If={parse:function(tagToken,remainTokens){var p,_this=this;this.branches=[],this.elseTemplates=[],this.liquid.parser.parseStream(remainTokens).on("start",(function(){return _this.branches.push({predicate:new Value(tagToken.args,_this.liquid),templates:p=[]})})).on("tag:elsif",(function(token){return _this.branches.push({predicate:new Value(token.args,_this.liquid),templates:p=[]})})).on("tag:else",(function(){return p=_this.elseTemplates})).on("tag:endif",(function(){this.stop()})).on("template",(function(tpl){return p.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))})).start()},render:function(ctx,emitter){var r,_a,_b,_c,predicate,templates,e_1_1,e_1,_d;return __generator(this,(function(_e){switch(_e.label){case 0:r=this.liquid.renderer,_e.label=1;case 1:_e.trys.push([1,7,8,9]),_a=__values(this.branches),_b=_a.next(),_e.label=2;case 2:return _b.done?[3,6]:(_c=_b.value,predicate=_c.predicate,templates=_c.templates,[4,predicate.value(ctx,ctx.opts.lenientIf)]);case 3:return isTruthy(_e.sent(),ctx)?[4,r.renderTemplates(templates,ctx,emitter)]:[3,5];case 4:return _e.sent(),[2];case 5:return _b=_a.next(),[3,2];case 6:return[3,9];case 7:return e_1_1=_e.sent(),e_1={error:e_1_1},[3,9];case 8:try{_b&&!_b.done&&(_d=_a.return)&&_d.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 9:return[4,r.renderTemplates(this.elseTemplates,ctx,emitter)];case 10:return _e.sent(),[2]}}))}},increment={parse:function(token){var tokenizer=new Tokenizer(token.args,this.liquid.options.operatorsTrie);this.variable=tokenizer.readIdentifier().content},render:function(context,emitter){var scope=context.environments;isNumber(scope[this.variable])||(scope[this.variable]=0);var val=scope[this.variable];scope[this.variable]++,emitter.write(stringify(val))}},layout={parseFilePath,renderFilePath,parse:function(token,remainTokens){var tokenizer=new Tokenizer(token.args,this.liquid.options.operatorsTrie);this.file=this.parseFilePath(tokenizer,this.liquid),this.currentFile=token.file,this.hash=new Hash(tokenizer.remaining()),this.tpls=this.liquid.parser.parseTokens(remainTokens)},render:function(ctx,emitter){var _a,liquid,hash,file,renderer,filepath,templates,html,blocks,_b,_c;return __generator(this,(function(_d){switch(_d.label){case 0:return liquid=(_a=this).liquid,hash=_a.hash,file=_a.file,renderer=liquid.renderer,null!==file?[3,2]:(ctx.setRegister("blockMode",BlockMode$1.OUTPUT),[4,renderer.renderTemplates(this.tpls,ctx,emitter)]);case 1:return _d.sent(),[2];case 2:return[4,this.renderFilePath(this.file,ctx,liquid)];case 3:return assert(filepath=_d.sent(),(function(){return'illegal filename "'.concat(filepath,'"')})),[4,liquid._parseLayoutFile(filepath,ctx.sync,this.currentFile)];case 4:return templates=_d.sent(),ctx.setRegister("blockMode",BlockMode$1.STORE),[4,renderer.renderTemplates(this.tpls,ctx)];case 5:return html=_d.sent(),void 0===(blocks=ctx.getRegister("blocks"))[""]&&(blocks[""]=function(parent,emitter){return emitter.write(html)}),ctx.setRegister("blockMode",BlockMode$1.OUTPUT),_c=(_b=ctx).push,[4,hash.render(ctx)];case 6:return _c.apply(_b,[_d.sent()]),[4,renderer.renderTemplates(templates,ctx,emitter)];case 7:return _d.sent(),ctx.pop(),[2]}}))}},BlockDrop=function(_super){function BlockDrop(superBlockRender){void 0===superBlockRender&&(superBlockRender=function(){return""});var _this=_super.call(this)||this;return _this.superBlockRender=superBlockRender,_this}return __extends(BlockDrop,_super),BlockDrop.prototype.super=function(){return this.superBlockRender()},BlockDrop}(Drop),block={parse:function(token,remainTokens){var _this=this,match=/\w+/.exec(token.args);this.block=match?match[0]:"",this.tpls=[],this.liquid.parser.parseStream(remainTokens).on("tag:endblock",(function(){this.stop()})).on("template",(function(tpl){return _this.tpls.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(token.getText()," not closed"))})).start()},render:function(ctx,emitter){var blockRender;return __generator(this,(function(_a){switch(_a.label){case 0:return blockRender=this.getBlockRender(ctx),ctx.getRegister("blockMode")!==BlockMode$1.STORE?[3,1]:(ctx.getRegister("blocks")[this.block]=blockRender,[3,3]);case 1:return[4,blockRender(new BlockDrop,emitter)];case 2:_a.sent(),_a.label=3;case 3:return[2]}}))},getBlockRender:function(ctx){var liquid=this.liquid,tpls=this.tpls,renderChild=ctx.getRegister("blocks")[this.block],renderCurrent=function(superBlock,emitter){return __generator(this,(function(_a){switch(_a.label){case 0:return ctx.push({block:superBlock}),[4,liquid.renderer.renderTemplates(tpls,ctx,emitter)];case 1:return _a.sent(),ctx.pop(),[2]}}))};return renderChild?function(superBlock,emitter){return renderChild(new BlockDrop((function(){return renderCurrent(superBlock,emitter)})),emitter)}:renderCurrent}},raw={parse:function(tagToken,remainTokens){var _this=this;this.tokens=[];var stream=this.liquid.parser.parseStream(remainTokens);stream.on("token",(function(token){"endraw"===token.name?stream.stop():_this.tokens.push(token)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))})),stream.start()},render:function(){return this.tokens.map((function(token){return token.getText()})).join("")}},TablerowloopDrop=function(_super){function TablerowloopDrop(length,cols,collection,variable){var _this=_super.call(this,length,collection,variable)||this;return _this.length=length,_this.cols=cols,_this}return __extends(TablerowloopDrop,_super),TablerowloopDrop.prototype.row=function(){return Math.floor(this.i/this.cols)+1},TablerowloopDrop.prototype.col0=function(){return this.i%this.cols},TablerowloopDrop.prototype.col=function(){return this.col0()+1},TablerowloopDrop.prototype.col_first=function(){return 0===this.col0()},TablerowloopDrop.prototype.col_last=function(){return this.col()===this.cols},TablerowloopDrop}(ForloopDrop),tablerow={parse:function(tagToken,remainTokens){var _this=this,tokenizer=new Tokenizer(tagToken.args,this.liquid.options.operatorsTrie),variable=tokenizer.readIdentifier();tokenizer.skipBlank();var p,tmp=tokenizer.readIdentifier();assert(tmp&&"in"===tmp.content,(function(){return"illegal tag: ".concat(tagToken.getText())})),this.variable=variable.content,this.collection=tokenizer.readValue(),this.hash=new Hash(tokenizer.remaining()),this.templates=[];var stream=this.liquid.parser.parseStream(remainTokens).on("start",(function(){return p=_this.templates})).on("tag:endtablerow",(function(){return stream.stop()})).on("template",(function(tpl){return p.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))}));stream.start()},render:function(ctx,emitter){var collection,_a,hash,offset,limit,cols,r,tablerowloop,scope,idx;return __generator(this,(function(_b){switch(_b.label){case 0:return _a=toEnumerable,[4,evalToken(this.collection,ctx)];case 1:return collection=_a.apply(void 0,[_b.sent()]),[4,this.hash.render(ctx)];case 2:hash=_b.sent(),offset=hash.offset||0,limit=void 0===hash.limit?collection.length:hash.limit,collection=collection.slice(offset,offset+limit),cols=hash.cols||collection.length,r=this.liquid.renderer,tablerowloop=new TablerowloopDrop(collection.length,cols,this.collection.getText(),this.variable),scope={tablerowloop},ctx.push(scope),idx=0,_b.label=3;case 3:return idx<collection.length?(scope[this.variable]=collection[idx],0===tablerowloop.col0()&&(1!==tablerowloop.row()&&emitter.write("</tr>"),emitter.write('<tr class="row'.concat(tablerowloop.row(),'">'))),emitter.write('<td class="col'.concat(tablerowloop.col(),'">')),[4,r.renderTemplates(this.templates,ctx,emitter)]):[3,6];case 4:_b.sent(),emitter.write("</td>"),_b.label=5;case 5:return idx++,tablerowloop.next(),[3,3];case 6:return collection.length&&emitter.write("</tr>"),ctx.pop(),[2]}}))}},tags={assign,for:For,capture,case:Case,comment,include,render,decrement,increment,cycle,if:If,layout,block,raw,tablerow,unless:{parse:function(tagToken,remainTokens){var p,_this=this;this.branches=[],this.elseTemplates=[],this.liquid.parser.parseStream(remainTokens).on("start",(function(){return _this.branches.push({predicate:new Value(tagToken.args,_this.liquid),test:isFalsy,templates:p=[]})})).on("tag:elsif",(function(token){return _this.branches.push({predicate:new Value(token.args,_this.liquid),test:isTruthy,templates:p=[]})})).on("tag:else",(function(){return p=_this.elseTemplates})).on("tag:endunless",(function(){this.stop()})).on("template",(function(tpl){return p.push(tpl)})).on("end",(function(){throw new Error("tag ".concat(tagToken.getText()," not closed"))})).start()},render:function(ctx,emitter){var r,_a,_b,_c,predicate,test_1,templates,value,e_1_1,e_1,_d;return __generator(this,(function(_e){switch(_e.label){case 0:r=this.liquid.renderer,_e.label=1;case 1:_e.trys.push([1,7,8,9]),_a=__values(this.branches),_b=_a.next(),_e.label=2;case 2:return _b.done?[3,6]:(_c=_b.value,predicate=_c.predicate,test_1=_c.test,templates=_c.templates,[4,predicate.value(ctx,ctx.opts.lenientIf)]);case 3:return value=_e.sent(),test_1(value,ctx)?[4,r.renderTemplates(templates,ctx,emitter)]:[3,5];case 4:return _e.sent(),[2];case 5:return _b=_a.next(),[3,2];case 6:return[3,9];case 7:return e_1_1=_e.sent(),e_1={error:e_1_1},[3,9];case 8:try{_b&&!_b.done&&(_d=_a.return)&&_d.call(_a)}finally{if(e_1)throw e_1.error}return[7];case 9:return[4,r.renderTemplates(this.elseTemplates,ctx,emitter)];case 10:return _e.sent(),[2]}}))}},break:{render:function(ctx,emitter){emitter.break=!0}},continue:{render:function(ctx,emitter){emitter.continue=!0}}},escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},unescapeMap={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"};function escape(str){return stringify(str).replace(/&|<|>|"|'/g,(function(m){return escapeMap[m]}))}var abs=Math.abs,atLeast=Math.max,atMost=Math.min,ceil=Math.ceil,floor=Math.floor;var rFormat=/%([-_0^#:]+)?(\d+)?([EO])?(.)/,monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNamesShort=monthNames.map(abbr),dayNamesShort=dayNames.map(abbr),suffixes={1:"st",2:"nd",3:"rd",default:"th"};function abbr(str){return str.slice(0,3)}function daysInMonth(d){var feb=function isLeapYear(d){var year=d.getFullYear();return!(3&year||!(year%100||year%400==0&&year))}(d)?29:28;return[31,feb,31,30,31,30,31,31,30,31,30,31]}function getDayOfYear(d){for(var num=0,i=0;i<d.getMonth();++i)num+=daysInMonth(d)[i];return num+d.getDate()}function getWeekOfYear(d,startDay){var now=getDayOfYear(d)+(startDay-d.getDay()),then=7-new Date(d.getFullYear(),0,1).getDay()+startDay;return String(Math.floor((now-then)/7)+1)}var padWidths={d:2,e:2,H:2,I:2,j:3,k:2,l:2,L:3,m:2,M:2,S:2,U:2,W:2},padChars={a:" ",A:" ",b:" ",B:" ",c:" ",e:" ",k:" ",l:" ",p:" ",P:" "},formatCodes={a:function(d){return dayNamesShort[d.getDay()]},A:function(d){return dayNames[d.getDay()]},b:function(d){return monthNamesShort[d.getMonth()]},B:function(d){return monthNames[d.getMonth()]},c:function(d){return d.toLocaleString()},C:function(d){return function century(d){return parseInt(d.getFullYear().toString().substring(0,2),10)}(d)},d:function(d){return d.getDate()},e:function(d){return d.getDate()},H:function(d){return d.getHours()},I:function(d){return String(d.getHours()%12||12)},j:function(d){return getDayOfYear(d)},k:function(d){return d.getHours()},l:function(d){return String(d.getHours()%12||12)},L:function(d){return d.getMilliseconds()},m:function(d){return d.getMonth()+1},M:function(d){return d.getMinutes()},N:function(d,opts){var width=Number(opts.width)||9;return function padEnd(str,length,ch){return void 0===ch&&(ch=" "),pad(str,length,ch,(function(str,ch){return str+ch}))}(String(d.getMilliseconds()).substr(0,width),width,"0")},p:function(d){return d.getHours()<12?"AM":"PM"},P:function(d){return d.getHours()<12?"am":"pm"},q:function(d){return function getSuffix(d){var str=d.getDate().toString(),index=parseInt(str.slice(-1));return suffixes[index]||suffixes.default}(d)},s:function(d){return Math.round(d.getTime()/1e3)},S:function(d){return d.getSeconds()},u:function(d){return d.getDay()||7},U:function(d){return getWeekOfYear(d,0)},w:function(d){return d.getDay()},W:function(d){return getWeekOfYear(d,1)},x:function(d){return d.toLocaleDateString()},X:function(d){return d.toLocaleTimeString()},y:function(d){return d.getFullYear().toString().substring(2,4)},Y:function(d){return d.getFullYear()},z:function(d,opts){var nOffset=Math.abs(d.getTimezoneOffset()),h=Math.floor(nOffset/60),m=nOffset%60;return(d.getTimezoneOffset()>0?"-":"+")+padStart(h,2,"0")+(opts.flags[":"]?":":"")+padStart(m,2,"0")},t:function(){return"\t"},n:function(){return"\n"},"%":function(){return"%"}};function format(d,match){var e_1,_a,_b=__read(match,5),input=_b[0],_c=_b[1],flagStr=void 0===_c?"":_c,width=_b[2],modifier=_b[3],conversion=_b[4],convert=formatCodes[conversion];if(!convert)return input;var flags={};try{for(var flagStr_1=__values(flagStr),flagStr_1_1=flagStr_1.next();!flagStr_1_1.done;flagStr_1_1=flagStr_1.next()){flags[flagStr_1_1.value]=!0}}catch(e_1_1){e_1={error:e_1_1}}finally{try{flagStr_1_1&&!flagStr_1_1.done&&(_a=flagStr_1.return)&&_a.call(flagStr_1)}finally{if(e_1)throw e_1.error}}var ret=String(convert(d,{flags,width,modifier})),padChar=padChars[conversion]||"0",padWidth=width||padWidths[conversion]||0;return flags["^"]?ret=ret.toUpperCase():flags["#"]&&(ret=function changeCase(str){return __spreadArray([],__read(str),!1).some((function(ch){return ch>="a"&&ch<="z"}))?str.toUpperCase():str.toLowerCase()}(ret)),flags._?padChar=" ":flags[0]&&(padChar="0"),flags["-"]&&(padWidth=0),padStart(ret,padWidth,padChar)}formatCodes.h=formatCodes.b;var hostTimezoneOffset=(new Date).getTimezoneOffset(),ISO8601_TIMEZONE_PATTERN=/([zZ]|([+-])(\d{2}):(\d{2}))$/,TimezoneDate=function(){function TimezoneDate(init,timezoneOffset){if(init instanceof TimezoneDate)this.date=init.date,timezoneOffset=init.timezoneOffset;else{var diff=6e4*(hostTimezoneOffset-timezoneOffset),time=new Date(init).getTime()+diff;this.date=new Date(time)}this.timezoneOffset=timezoneOffset}return TimezoneDate.prototype.getTime=function(){return this.date.getTime()},TimezoneDate.prototype.getMilliseconds=function(){return this.date.getMilliseconds()},TimezoneDate.prototype.getSeconds=function(){return this.date.getSeconds()},TimezoneDate.prototype.getMinutes=function(){return this.date.getMinutes()},TimezoneDate.prototype.getHours=function(){return this.date.getHours()},TimezoneDate.prototype.getDay=function(){return this.date.getDay()},TimezoneDate.prototype.getDate=function(){return this.date.getDate()},TimezoneDate.prototype.getMonth=function(){return this.date.getMonth()},TimezoneDate.prototype.getFullYear=function(){return this.date.getFullYear()},TimezoneDate.prototype.toLocaleTimeString=function(locale){return this.date.toLocaleTimeString(locale)},TimezoneDate.prototype.toLocaleDateString=function(locale){return this.date.toLocaleDateString(locale)},TimezoneDate.prototype.getTimezoneOffset=function(){return this.timezoneOffset},TimezoneDate.createDateFixedToTimezone=function(dateString){var m=dateString.match(ISO8601_TIMEZONE_PATTERN);if(m&&"Z"===m[1])return new TimezoneDate(+new Date(dateString),0);if(m&&m[2]&&m[3]&&m[4]){var _a=__read(m,5),sign=_a[2],hours=_a[3],minutes=_a[4],delta=("+"===sign?-1:1)*(60*parseInt(hours,10)+parseInt(minutes,10));return new TimezoneDate(+new Date(dateString),delta)}return new Date(dateString)},TimezoneDate}();var builtinFilters=Object.freeze({__proto__:null,escape,escapeOnce:function escapeOnce(str){return escape(function unescape(str){return String(str).replace(/&(amp|lt|gt|#34|#39);/g,(function(m){return unescapeMap[m]}))}(str))},newlineToBr:function newlineToBr(v){return v.replace(/\n/g,"<br />\n")},stripHtml:function stripHtml(v){return v.replace(/<script.*?<\/script>|<!--.*?-->|<style.*?<\/style>|<.*?>/g,"")},abs,atLeast,atMost,ceil,dividedBy:function(v,arg){return v/arg},floor,minus:function(v,arg){return v-arg},modulo:function(v,arg){return v%arg},times:function(v,arg){return v*arg},round:function round(v,arg){void 0===arg&&(arg=0);var amp=Math.pow(10,arg);return Math.round(v*amp)/amp},plus:function plus(v,arg){return Number(v)+Number(arg)},sortNatural:function sortNatural(input,property){return input&&input.sort?void 0!==property?__spreadArray([],__read(input),!1).sort((function(lhs,rhs){return caseInsensitiveCompare(lhs[property],rhs[property])})):__spreadArray([],__read(input),!1).sort(caseInsensitiveCompare):[]},urlDecode:function(x){return x.split("+").map(decodeURIComponent).join(" ")},urlEncode:function(x){return x.split(" ").map(encodeURIComponent).join("+")},join:function(v,arg){return v.join(void 0===arg?" ":arg)},last:function(v){return isArray(v)?last$1(v):""},first:function(v){return isArray(v)?v[0]:""},reverse:function(v){return __spreadArray([],__read(v),!1).reverse()},sort:function sort(arr,property){var _this=this,getValue=function(obj){return property?_this.context.getFromScope(obj,property.split(".")):obj};return toArray(arr).sort((function(lhs,rhs){return(lhs=getValue(lhs))<(rhs=getValue(rhs))?-1:lhs>rhs?1:0}))},size:function(v){return v&&v.length||0},map:function map(arr,property){var _this=this;return toArray(arr).map((function(obj){return _this.context.getFromScope(obj,property.split("."))}))},compact:function compact(arr){return toArray(arr).filter((function(x){return!isNil(x)}))},concat:function concat(v,arg){return toArray(v).concat(arg)},slice:function slice(v,begin,length){return void 0===length&&(length=1),begin=begin<0?v.length+begin:begin,v.slice(begin,begin+length)},where:function where(arr,property,expected){var _this=this;return toArray(arr).filter((function(obj){var value=_this.context.getFromScope(obj,String(property).split("."));return void 0===expected?isTruthy(value,_this.context):value===expected}))},uniq:function uniq(arr){var u={};return(arr||[]).filter((function(val){return!u.hasOwnProperty(String(val))&&(u[String(val)]=!0,!0)}))},date:function date(v,arg){var date,opts=this.context.opts;return function isValidDate(date){return(date instanceof Date||date instanceof TimezoneDate)&&!isNaN(date.getTime())}(date="now"===v||"today"===v?new Date:isNumber(v)?new Date(1e3*v):isString(v)?/^\d+$/.test(v)?new Date(1e3*+v):opts.preserveTimezones?TimezoneDate.createDateFixedToTimezone(v):new Date(v):v)?(opts.hasOwnProperty("timezoneOffset")&&(date=new TimezoneDate(date,opts.timezoneOffset)),function strftime(d,formatStr){for(var match,output="",remaining=formatStr;match=rFormat.exec(remaining);)output+=remaining.slice(0,match.index),remaining=remaining.slice(match.index+match[0].length),output+=format(d,match);return output+remaining}(date,arg)):v},Default:function Default(v,arg){return isArray(v)||isString(v)?v.length?v:arg:isFalsy(toValue$1(v),this.context)?arg:v},json:function json(v){return JSON.stringify(v)},append:function append(v,arg){return assert(2===arguments.length,"append expect 2 arguments"),stringify(v)+stringify(arg)},prepend:function prepend(v,arg){return assert(2===arguments.length,"prepend expect 2 arguments"),stringify(arg)+stringify(v)},lstrip:function lstrip(v){return stringify(v).replace(/^\s+/,"")},downcase:function downcase(v){return stringify(v).toLowerCase()},upcase:function upcase(str){return stringify(str).toUpperCase()},remove:function remove(v,arg){return stringify(v).split(String(arg)).join("")},removeFirst:function removeFirst(v,l){return stringify(v).replace(String(l),"")},rstrip:function rstrip(str){return stringify(str).replace(/\s+$/,"")},split:function split(v,arg){return stringify(v).split(String(arg))},strip:function strip(v){return stringify(v).trim()},stripNewlines:function stripNewlines(v){return stringify(v).replace(/\n/g,"")},capitalize:function capitalize(str){return(str=stringify(str)).charAt(0).toUpperCase()+str.slice(1).toLowerCase()},replace:function replace(v,pattern,replacement){return stringify(v).split(String(pattern)).join(replacement)},replaceFirst:function replaceFirst(v,arg1,arg2){return stringify(v).replace(String(arg1),arg2)},truncate:function truncate(v,l,o){return void 0===l&&(l=50),void 0===o&&(o="..."),(v=stringify(v)).length<=l?v:v.substr(0,l-o.length)+o},truncatewords:function truncatewords(v,l,o){void 0===l&&(l=15),void 0===o&&(o="...");var arr=v.split(/\s+/),ret=arr.slice(0,l).join(" ");return arr.length>=l&&(ret+=o),ret}}),TagMap=function(){function TagMap(){this.impls={}}return TagMap.prototype.get=function(name){var impl=this.impls[name];return assert(impl,(function(){return'tag "'.concat(name,'" not found')})),impl},TagMap.prototype.set=function(name,impl){this.impls[name]=impl},TagMap}(),FilterMap=function(){function FilterMap(strictFilters,liquid){this.strictFilters=strictFilters,this.liquid=liquid,this.impls={}}return FilterMap.prototype.get=function(name){var impl=this.impls[name];return assert(impl||!this.strictFilters,(function(){return"undefined filter: ".concat(name)})),impl},FilterMap.prototype.set=function(name,impl){this.impls[name]=impl},FilterMap.prototype.create=function(name,args){return new Filter(name,this.get(name),args,this.liquid)},FilterMap}(),Liquid=function(){function Liquid(opts){var _this=this;void 0===opts&&(opts={}),this.options=function normalize(options){if(options.hasOwnProperty("operators")&&(options.operatorsTrie=createTrie(options.operators)),options.hasOwnProperty("root")&&(options.hasOwnProperty("partials")||(options.partials=options.root),options.hasOwnProperty("layouts")||(options.layouts=options.root)),options.hasOwnProperty("cache")){var cache=void 0;cache="number"==typeof options.cache?options.cache>0?new LRU(options.cache):void 0:"object"==typeof options.cache?options.cache:options.cache?new LRU(1024):void 0,options.cache=cache}return!(options=__assign(__assign({},defaultOptions),options)).fs.dirname&&options.relativeReference&&(console.warn("[LiquidJS] `fs.dirname` is required for relativeReference, set relativeReference to `false` to suppress this warning, or provide implementation for `fs.dirname`"),options.relativeReference=!1),options.root=normalizeDirectoryList(options.root),options.partials=normalizeDirectoryList(options.partials),options.layouts=normalizeDirectoryList(options.layouts),options}(opts),this.parser=new Parser(this),this.renderer=new Render,this.filters=new FilterMap(this.options.strictFilters,this),this.tags=new TagMap,forOwn(tags,(function(conf,name){return _this.registerTag(snakeCase(name),conf)})),forOwn(builtinFilters,(function(handler,name){return _this.registerFilter(snakeCase(name),handler)}))}return Liquid.prototype.parse=function(html,filepath){return this.parser.parse(html,filepath)},Liquid.prototype._render=function(tpl,scope,renderOptions){var ctx=new Context(scope,this.options,renderOptions);return this.renderer.renderTemplates(tpl,ctx)},Liquid.prototype.render=function(tpl,scope,renderOptions){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,toPromise(this._render(tpl,scope,__assign(__assign({},renderOptions),{sync:!1})))]}))}))},Liquid.prototype.renderSync=function(tpl,scope,renderOptions){return toValue(this._render(tpl,scope,__assign(__assign({},renderOptions),{sync:!0})))},Liquid.prototype.renderToNodeStream=function(tpl,scope,renderOptions){void 0===renderOptions&&(renderOptions={});var ctx=new Context(scope,this.options,renderOptions);return this.renderer.renderTemplatesToNodeStream(tpl,ctx)},Liquid.prototype._parseAndRender=function(html,scope,renderOptions){var tpl=this.parse(html);return this._render(tpl,scope,renderOptions)},Liquid.prototype.parseAndRender=function(html,scope,renderOptions){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,toPromise(this._parseAndRender(html,scope,__assign(__assign({},renderOptions),{sync:!1})))]}))}))},Liquid.prototype.parseAndRenderSync=function(html,scope,renderOptions){return toValue(this._parseAndRender(html,scope,__assign(__assign({},renderOptions),{sync:!0})))},Liquid.prototype._parsePartialFile=function(file,sync,currentFile){return this.parser.parseFile(file,sync,LookupType.Partials,currentFile)},Liquid.prototype._parseLayoutFile=function(file,sync,currentFile){return this.parser.parseFile(file,sync,LookupType.Layouts,currentFile)},Liquid.prototype.parseFile=function(file){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,toPromise(this.parser.parseFile(file,!1))]}))}))},Liquid.prototype.parseFileSync=function(file){return toValue(this.parser.parseFile(file,!0))},Liquid.prototype.renderFile=function(file,ctx,renderOptions){return __awaiter(this,void 0,void 0,(function(){var templates;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parseFile(file)];case 1:return templates=_a.sent(),[2,this.render(templates,ctx,renderOptions)]}}))}))},Liquid.prototype.renderFileSync=function(file,ctx,renderOptions){var templates=this.parseFileSync(file);return this.renderSync(templates,ctx,renderOptions)},Liquid.prototype.renderFileToNodeStream=function(file,scope,renderOptions){return __awaiter(this,void 0,void 0,(function(){var templates;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,this.parseFile(file)];case 1:return templates=_a.sent(),[2,this.renderToNodeStream(templates,scope,renderOptions)]}}))}))},Liquid.prototype._evalValue=function(str,ctx){return new Value(str,this).value(ctx,!1)},Liquid.prototype.evalValue=function(str,ctx){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(_a){return[2,toPromise(this._evalValue(str,ctx))]}))}))},Liquid.prototype.evalValueSync=function(str,ctx){return toValue(this._evalValue(str,ctx))},Liquid.prototype.registerFilter=function(name,filter){this.filters.set(name,filter)},Liquid.prototype.registerTag=function(name,tag){this.tags.set(name,tag)},Liquid.prototype.plugin=function(plugin){return plugin.call(this,Liquid)},Liquid.prototype.express=function(){var self=this,firstCall=!0;return function(filePath,ctx,callback){var _a,_b,_c;if(firstCall){firstCall=!1;var dirs=normalizeDirectoryList(this.root);(_a=self.options.root).unshift.apply(_a,__spreadArray([],__read(dirs),!1)),(_b=self.options.layouts).unshift.apply(_b,__spreadArray([],__read(dirs),!1)),(_c=self.options.partials).unshift.apply(_c,__spreadArray([],__read(dirs),!1))}self.renderFile(filePath,ctx).then((function(html){return callback(null,html)}),callback)}},Liquid}()}}]);